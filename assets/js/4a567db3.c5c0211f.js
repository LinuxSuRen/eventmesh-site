"use strict";(self.webpackChunkeventmesh_site=self.webpackChunkeventmesh_site||[]).push([[3557],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=c(n),d=a,f=m["".concat(s,".").concat(d)]||m[d]||p[d]||r;return n?o.createElement(f,l(l({ref:t},u),{},{components:n})):o.createElement(f,l({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[m]="string"==typeof e?e:a,l[1]=i;for(var c=2;c<r;c++)l[c]=n[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},74933:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var o=n(87462),a=(n(67294),n(3905));const r={},l="Run Serverless Workflow Demo",i={unversionedId:"instruction/workflow-demo",id:"instruction/workflow-demo",title:"Run Serverless Workflow Demo",description:"1. Environment Requirements",source:"@site/docs/instruction/07-workflow-demo.md",sourceDirName:"instruction",slug:"/instruction/workflow-demo",permalink:"/docs/next/instruction/workflow-demo",draft:!1,editUrl:"https://github.com/apache/eventmesh-site/edit/master/docs/instruction/07-workflow-demo.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Integrate EventMesh with K8S",permalink:"/docs/next/instruction/operator"},next:{title:"Frequently Asked Questions",permalink:"/docs/next/instruction/faq"}},s={},c=[{value:"1. Environment Requirements",id:"1-environment-requirements",level:2},{value:"2. Initialize Database",id:"2-initialize-database",level:2},{value:"Initialize workflow database",id:"initialize-workflow-database",level:3},{value:"Initialize catalog database",id:"initialize-catalog-database",level:3},{value:"3. Import Workflow Demo Data",id:"3-import-workflow-demo-data",level:2},{value:"Import eventmesh-workflow db data",id:"import-eventmesh-workflow-db-data",level:3},{value:"Import eventmesh-catalog db data",id:"import-eventmesh-catalog-db-data",level:3},{value:"4. Run Workflow Services",id:"4-run-workflow-services",level:2},{value:"Run eventmesh-workflow service",id:"run-eventmesh-workflow-service",level:3},{value:"Run eventmesh-catalog service",id:"run-eventmesh-catalog-service",level:3},{value:"5. Run Workflow Demo Pub/Sub Application",id:"5-run-workflow-demo-pubsub-application",level:2},{value:"Pub application",id:"pub-application",level:3},{value:"Sub application",id:"sub-application",level:3}],u={toc:c},m="wrapper";function p(e){let{components:t,...r}=e;return(0,a.kt)(m,(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"run-serverless-workflow-demo"},"Run Serverless Workflow Demo"),(0,a.kt)("h2",{id:"1-environment-requirements"},"1. Environment Requirements"),(0,a.kt)("p",null,"The current Runbook is based on the all-in-one approach, and this document is also based on that premise."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"MySQL 8.0+")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Nacos latest version is sufficient")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"EventMesh-Server "))),(0,a.kt)("p",null,"Note: Change connector-type to standalone"),(0,a.kt)("p",null,"All three services mentioned above need to be started in advance."),(0,a.kt)("h2",{id:"2-initialize-database"},"2. Initialize Database"),(0,a.kt)("h3",{id:"initialize-workflow-database"},"Initialize workflow database"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cd eventmesh-workflow-go/distribution\nmysql -h mysql_host -u mysql_user -p mysql_password < ./mysql-schema.sql\n")),(0,a.kt)("h3",{id:"initialize-catalog-database"},"Initialize catalog database"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cd eventmesh-catalog-go/distribution\nmysql -h mysql_host -u mysql_user -p mysql_password < ./mysql-schema.sql\n")),(0,a.kt)("h2",{id:"3-import-workflow-demo-data"},"3. Import Workflow Demo Data"),(0,a.kt)("h3",{id:"import-eventmesh-workflow-db-data"},"Import eventmesh-workflow db data"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Workflow basic information: t_workflow"),(0,a.kt)("li",{parentName:"ul"},"Workflow task information: t_workflow_task"),(0,a.kt)("li",{parentName:"ul"},"Workflow task execution information: t_worklfow_task_action"),(0,a.kt)("li",{parentName:"ul"},"Workflow task relation information: t_wofkflow_task_relation")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'cd eventmesh-workflow-go/cmd\nbash build.sh\n./workflow-cli create --file ../configs/testcreateworkflow.yaml --dsn "root:123456@(127.0.0.1:3306)/db_workflow?charset=utf8&parseTime=True&loc=Local"\n')),(0,a.kt)("h3",{id:"import-eventmesh-catalog-db-data"},"Import eventmesh-catalog db data"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'cd eventmesh-catalog-go/cmd\nbash build.sh\n./catalog-cli create --file ../configs/testorder.yaml --dsn "root:123456@(127.0.0.1:3306)/db_catalog?charset=utf8&parseTime=True&loc=Local"\n./catalog-cli create --file ../configs/testpayment.yaml --dsn "root:123456@(127.0.0.1:3306)/db_catalog?charset=utf8&parseTime=True&loc=Local"\n./catalog-cli create --file ../configs/testexpress.yaml --dsn "root:123456@(127.0.0.1:3306)/db_catalog?charset=utf8&parseTime=True&loc=Local"\n')),(0,a.kt)("h2",{id:"4-run-workflow-services"},"4. Run Workflow Services"),(0,a.kt)("h3",{id:"run-eventmesh-workflow-service"},"Run eventmesh-workflow service"),(0,a.kt)("p",null,"Modify the service's runtime configuration file ",(0,a.kt)("inlineCode",{parentName:"p"},"./configs/workflow.yaml")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yml"},'server:\n  port: 11012\n  name: "EVENTMESH-workflow"\nflow:\n  queue:\n    store: in-memory\n  scheduler:\n    type: in-line\n    interval: 10 # milliseconds\n  protocol: meshmessage\ncatalog:\n  server_name: "EVENTMESH-catalog"\neventmesh:\n  host: "127.0.0.1"\n  env: "PRD"\n  idc: "DEFAULT"\n  sys: "DEFAULT"\n  username: "username"\n  password: "password"\n  producer_group: "EventMeshTest-producerGroup"\n  ttl: 4000\n  grpc:\n    port: 10205\nplugins:\n  registry:\n    nacos:\n      address_list: "127.0.0.1:8848"\n  selector:\n    nacos:\n      address_list: "127.0.0.1:8848"\n  database:\n    mysql:\n      dsn: "root:123456@(127.0.0.1:3306)/db_workflow?charset=utf8&parseTime=True&loc=Local"\n      max_idle: 50\n      max_open: 100\n      max_lifetime: 180000\n  log:\n    default:\n      - writer: file\n        level: info\n        writer_config:\n          filename: ./workflow.log\n          max_size: 10\n          max_backups: 10\n          max_age: 7\n          compress:  false\n    schedule:\n      - writer: file\n        level: info\n        writer_config:\n          filename: ./workflow_schedule.log\n          max_size: 10\n          max_backups: 10\n          max_age: 7\n          compress:  false\n    queue:\n      - writer: file\n        level: info\n        writer_config:\n          filename: ./workflow_queue.log\n          max_size: 10\n          max_backups: 10\n          max_age: 7\n          compress:  false\n')),(0,a.kt)("p",null,"Run the service: (Can also be directly run in GoLand using main)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"go build\n./eventmesh-workflow-go\n")),(0,a.kt)("p",null,"Notes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Eventmesh configuration needs to correspond to eventmsh-server configuration."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yml"},'eventmesh:\n  host: "127.0.0.1"\n  env: "PRD"\n  idc: "DEFAULT"\n  sys: "DEFAULT"\n  username: "username"\n  password: "password"\n  producer_group: "EventMeshTest-producerGroup"\n  ttl: 4000\n  grpc:\n    port: 10205\n'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Nacos address needs to be modified.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"MySQL DSN needs to be modified."))),(0,a.kt)("h3",{id:"run-eventmesh-catalog-service"},"Run eventmesh-catalog service"),(0,a.kt)("p",null,"Modify the configuration file ",(0,a.kt)("inlineCode",{parentName:"p"},"./configs/catalog.yaml"),", similar points to the workflow service."),(0,a.kt)("p",null,"Run the service: (Can also be directly run in GoLand using main)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"go build\n./eventmesh-catalog-go\n")),(0,a.kt)("h2",{id:"5-run-workflow-demo-pubsub-application"},"5. Run Workflow Demo Pub/Sub Application"),(0,a.kt)("p",null,"It is necessary to start the pub/sub application after the successful run of eventmesh-workflow/eventmesh-catalog services."),(0,a.kt)("h3",{id:"pub-application"},"Pub application"),(0,a.kt)("p",null,"WorkflowAsyncPublishInstance"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"This configuration needs to correspond to EventMesh-Server.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"workflow-demo-1",src:n(87525).Z,width:"907",height:"111"})),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Workflowid needs to correspond to the imported data.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"workflow-demo-2",src:n(10169).Z,width:"907",height:"192"})),(0,a.kt)("h3",{id:"sub-application"},"Sub application"),(0,a.kt)("p",null,"WorkflowOrderAsyncSubscribe"),(0,a.kt)("p",null,"WorkflowPaymentAsyncSubscribe"),(0,a.kt)("p",null,"WorkflowExpressAsyncSubscribe"),(0,a.kt)("p",null,"Note: workflowid needs to correspond to the imported data."),(0,a.kt)("p",null,"Run results:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"t_workflow_instance: Status 2, run completed.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"workflow-demo-3",src:n(87798).Z,width:"907",height:"52"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"t_workflow_task_instance: All tasks in the process have status 4, run successful.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"workflow-demo-4",src:n(97362).Z,width:"907",height:"80"})))}p.isMDXComponent=!0},87525:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/workflow-demo-1-7e72b77ef7cb4e71f895f0535fe2677c.png"},10169:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/workflow-demo-2-f00292d2b2b54e4f27b2e44c413504de.png"},87798:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/workflow-demo-3-59c4d116731fda6f56735ed1ef459bda.png"},97362:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/workflow-demo-4-47aff7784ac24f9b7d0bb1d0a821dc54.png"}}]);